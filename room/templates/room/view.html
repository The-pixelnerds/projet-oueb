{% extends "room/template.html" %}
{% load static %}

{% block script %}
    <script>
        let room_id = {{ room.id }};
        let lastMessageId = {{ lastMessageId }};
    </script>
    <script src="{% static 'room/js/messages.js' %}"></script>
    <script src="{% static 'room/js/rooms.js' %}"></script>
{% endblock %}

{% block room_list %}
    <div id="rooms">
    {% for current_room in rooms %}
        {% if current_room.id == room.id %}
            <a href="{% url 'room:view' current_room.id %}" id="selected" ><b>{{ current_room.name }}</b></a>
        {% else %}
            <a href="{% url 'room:view' current_room.id %}">{{ current_room.name }}</a>
        {% endif %}
    {% endfor %}
    </div>
    <a href="{% url 'room:create_room' %}" id="newRoom">create new room</a>
    <a href="{% url 'room:remove_room' %}" id="removeroom">remove room</a>
    <br>
    {{ room.description }}
{% endblock %}

{% block content %}
    {% for message in messages %}
        {% if message.user.id == currentuserid %}
            <div class="message yours">
        {% else %}
            <div class="message notyours">
        {% endif %}
            <div class="message_header">
                <div class="message_author">{{ message.user.username }}</div>
                <div class="message_date">{{ message.timestamp }}</div>
            </div>
            <div class="message_text">{{ message.message }}</div>
        </div>
    {% endfor %}
{% endblock %}

{% block form %}
    {% comment %} partie qui s'occupe de l'envoie de message {% endcomment %}
    <form action="{% url 'room:view' room.id %}" method="post">
        {% csrf_token %}
        <input type="text" name="message" id="message" placeholder="Votre message" autocomplete="off" autofocus>
        <input type="submit" value="Envoyer">
    </form>
{% endblock %}

{% block persons %}
    {% for person in persons %}
        {% if person.user.id == currentuserid %}
            <div class="person" id="you">
        {% else %}
            <div class="person">
        {% endif %}
            <p>{{ person.user.username }}</p>
            <p>{{ person.description }}</p>
            <img src="{% static 'room/images/profilepic.png' %}" alt="profil" style="filter:hue-rotate( {{ person.colorRotation }}deg);">
        </div>
    {% endfor %}
{% endblock %}